---
layout: default
---

<div class="strava-stats">
  <h1>{{ page.title }}</h1>
  {{ content }}
  
  <div class="chart-container">
    <h2>Weekly Running Distance</h2>
    <div id="weekly-running-chart"></div>
  </div>

  <div class="chart-container">
    <h2>Cumulative Running Distance</h2>
    <div id="cumulative-mileage-chart"></div>
  </div>

  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script>
    // Function to fetch and display a chart
    async function displayChart(endpoint, containerId) {
      try {
        console.log(`Fetching data from ${endpoint}`);
        const response = await fetch(endpoint);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const html = await response.text();
        console.log(`Received HTML from ${endpoint}:`, html);
        
        // Insert the HTML directly into the container
        document.getElementById(containerId).innerHTML = html;
        
        // Extract the plot div ID from the HTML
        const plotDiv = document.getElementById(containerId).querySelector('.plotly-graph-div');
        if (!plotDiv) {
          throw new Error(`No plot div found in HTML for ${containerId}`);
        }
        
        // Get the plot data from the script tag
        const scriptTag = document.getElementById(containerId).querySelector('script');
        if (!scriptTag) {
          throw new Error(`No script tag found in HTML for ${containerId}`);
        }
        
        // Execute the script to initialize the plot
        eval(scriptTag.textContent);
        
        console.log(`Successfully rendered plot for ${endpoint}`);
      } catch (error) {
        console.error(`Error fetching ${endpoint}:`, error);
        document.getElementById(containerId).innerHTML = 
          `<p class="error">Failed to load data. Please try again later.</p>`;
      }
    }

    // Fetch and display both charts
    displayChart('/strava/weekly_running', 'weekly-running-chart');
    displayChart('/strava/cumulative_mileage', 'cumulative-mileage-chart');
  </script>
</div>

<style>
.strava-stats {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.chart-container {
  margin: 40px 0;
}

.chart-container h2 {
  margin-bottom: 20px;
  color: #FC4C02;  /* Strava orange */
}

#weekly-running-chart,
#cumulative-mileage-chart {
  width: 100%;
  height: 600px;
  margin: 20px 0;
}

.error {
  color: #721c24;
  background-color: #f8d7da;
  border: 1px solid #f5c6cb;
  padding: 15px;
  border-radius: 4px;
  margin: 10px 0;
}
</style>